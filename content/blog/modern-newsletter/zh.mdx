---
title: 'ä½¿ç”¨ Next.js å’Œ Buttondown æ„å»ºç°ä»£åŒ–çš„è®¢é˜…ç³»ç»Ÿ'
date: '2025-02-11'
excerpt: 'æ·±å…¥æ¢è®¨å¦‚ä½•åˆ›å»ºä¸€ä¸ªå…·æœ‰å›½é™…åŒ–ã€åŠ¨ç”»æ•ˆæœå’Œå¼ºå¤§é”™è¯¯å¤„ç†åŠŸèƒ½çš„å®Œå–„è®¢é˜…ç³»ç»Ÿã€‚'
---

åˆ›å»ºè®¢é˜…ç³»ç»Ÿä¹çœ‹ä¹‹ä¸‹å¯èƒ½å¾ˆç®€å•ï¼Œä½†è¦æ„å»ºä¸€ä¸ªå®Œå–„ã€ç”¨æˆ·å‹å¥½ä¸”ç¨³å¥çš„ç³»ç»Ÿï¼Œéœ€è¦ä»”ç»†è€ƒè™‘è®¸å¤šæ–¹é¢ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†åˆ†äº«å¦‚ä½•ä½¿ç”¨ Next.jsã€Buttondown å’Œå„ç§ç°ä»£ Web æŠ€æœ¯ä¸ºè¿™ä¸ªç½‘ç«™æ„å»ºè®¢é˜…ç³»ç»Ÿã€‚

## åŠŸèƒ½æ¦‚è¿°

è¯¥è®¢é˜…ç³»ç»ŸåŒ…å«å‡ ä¸ªå…³é”®ç‰¹æ€§ï¼š

- ğŸŒ æ”¯æŒå¤šè¯­è¨€å›½é™…åŒ–
- âœ¨ æµç•…çš„åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ
- ğŸ›¡ï¸ é€Ÿç‡é™åˆ¶å’ŒéªŒè¯
- ğŸ¨ å¸¦æ¸å˜åŠ¨ç”»çš„ç²¾ç¾ UI
- ğŸ”„ å…¨é¢çš„é”™è¯¯å¤„ç†
- ğŸ“± å“åº”å¼è®¾è®¡
- ğŸŒ™ æ·±è‰²æ¨¡å¼æ”¯æŒ
- ğŸ”„ ä½¿ç”¨ Reducer çš„é›†ä¸­çŠ¶æ€ç®¡ç†

## æŠ€æœ¯å®ç°

### 1. ä½¿ç”¨æšä¸¾å®ç°ç±»å‹å®‰å…¨çš„é”™è¯¯å¤„ç†

æˆ‘ä»¬ä½¿ç”¨ TypeScript æšä¸¾æ¥å®ç°ç±»å‹å®‰å…¨çš„é”™è¯¯å¤„ç†ï¼Œç¡®ä¿æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­çš„é”™è¯¯ä»£ç ä¿æŒä¸€è‡´ï¼š

```typescript
export enum NewsletterErrorCode {
  InvalidEmail = 'INVALID_EMAIL',
  AlreadySubscribed = 'ALREADY_SUBSCRIBED',
  RateLimited = 'RATE_LIMITED',
  ServerError = 'SERVER_ERROR',
  UnknownError = 'UNKNOWN_ERROR',
}
```

ä¸å­—ç¬¦ä¸²å­—é¢é‡ç›¸æ¯”ï¼Œè¿™ç§æ–¹æ³•æä¾›äº†æ›´å¥½çš„ç±»å‹å®‰å…¨æ€§å’Œè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚

### 2. ä½¿ç”¨ Reducer æ¨¡å¼çš„çŠ¶æ€ç®¡ç†

æˆ‘ä»¬é‡‡ç”¨ Reducer æ¨¡å¼è¿›è¡Œé›†ä¸­çŠ¶æ€ç®¡ç†ï¼Œä½¿ä»£ç æ›´æ˜“ç»´æŠ¤ä¸”æ›´å¯é¢„æµ‹ï¼š

```typescript
interface NewsletterFormState {
  email: string;
  status: FormStatus;
  message: string;
}

type NewsletterFormAction =
  | { type: 'SET_EMAIL'; payload: string }
  | { type: 'SET_LOADING' }
  | { type: 'SET_SUCCESS' }
  | { type: 'SET_ERROR'; payload: string }
  | { type: 'RESET' };

export function newsletterFormReducer(
  state: NewsletterFormState,
  action: NewsletterFormAction
): NewsletterFormState {
  switch (action.type) {
    case 'SET_EMAIL':
      return { ...state, email: action.payload };
    case 'SET_LOADING':
      return { ...state, status: FormStatus.Loading, message: '' };
    case 'SET_SUCCESS':
      return { ...state, status: FormStatus.Success, email: '', message: '' };
    case 'SET_ERROR':
      return { ...state, status: FormStatus.Error, message: action.payload };
    case 'RESET':
      return { ...state, status: FormStatus.Idle, message: '' };
    default:
      return state;
  }
}
```

è¿™ç§æ–¹æ³•å¸¦æ¥ä»¥ä¸‹å¥½å¤„ï¼š

- å°†çŠ¶æ€é€»è¾‘é›†ä¸­åœ¨ä¸€å¤„
- ç±»å‹å®‰å…¨çš„çŠ¶æ€è½¬æ¢
- å¯é¢„æµ‹çš„çŠ¶æ€æ›´æ–°
- çº¯å‡½æ•°ä¾¿äºæµ‹è¯•
- æ›´å¥½çš„ä»£ç ç»„ç»‡

è¡¨å•ç»„ä»¶ä½¿ç”¨ React çš„ `useReducer` Hook æ¥ä½¿ç”¨è¿™ä¸ª Reducerï¼š

```typescript
const [state, dispatch] = useReducer(newsletterFormReducer, initialState);

// è¡¨å•æäº¤ç¤ºä¾‹
const handleSubmit = async (e: React.FormEvent) => {
  e.preventDefault();
  dispatch({ type: 'SET_LOADING' });
  try {
    // è¡¨å•æäº¤é€»è¾‘...
    dispatch({ type: 'SET_SUCCESS' });
  } catch {
    dispatch({ type: 'SET_ERROR', payload: errorMessage });
  }
};
```

### 3. è¡¨å•çŠ¶æ€ç®¡ç†

æˆ‘ä»¬ä½¿ç”¨ä¸“é—¨çš„æšä¸¾æ¥ç®¡ç†è¡¨å•çŠ¶æ€ï¼Œä½¿ä»£ç æ›´æ˜“ç»´æŠ¤ä¸”ç±»å‹å®‰å…¨ï¼š

```typescript
export enum FormStatus {
  Idle = 'idle',
  Loading = 'loading',
  Success = 'success',
  Error = 'error',
}
```

è¿™ä¸ªæšä¸¾åœ¨ç»„ä»¶ä¸­ç”¨äºä¸€è‡´çš„çŠ¶æ€ç®¡ç†å’ŒåŠ¨ç”»æ§åˆ¶ã€‚

### 4. é›†æˆæšä¸¾çš„ Zod éªŒè¯æ¨¡å¼

æˆ‘ä»¬çš„ Zod éªŒè¯æ¨¡å¼ä¸é”™è¯¯æšä¸¾é›†æˆï¼Œå®ç°ç±»å‹å®‰å…¨çš„éªŒè¯ï¼š

```typescript
export const newsletterSchema = z.object({
  email: z.string().email({ message: NewsletterErrorCode.InvalidEmail }),
  locale: z.string().min(2).max(10),
});
```

### 5. å¸¦é€Ÿç‡é™åˆ¶çš„ API è·¯ç”±

API è·¯ç”±åŒ…å«é€Ÿç‡é™åˆ¶ä»¥é˜²æ­¢æ»¥ç”¨ï¼š

```typescript
const RATE_LIMIT = {
  WINDOW: 3600000, // 1å°æ—¶ï¼ˆæ¯«ç§’ï¼‰
  MAX_REQUESTS: 10,
} as const;
```

æˆ‘ä»¬è·Ÿè¸ªæ¯ä¸ª IP åœ°å€çš„è¯·æ±‚ï¼Œå¹¶é™åˆ¶æ¯å°æ—¶æœ€å¤š 10 æ¬¡å°è¯•ã€‚

### 6. åŠ¨ç”» UI ç»„ä»¶

è¡¨å•ä½¿ç”¨ Framer Motion å®ç°æµç•…çš„åŠ¨ç”»æ•ˆæœï¼ŒåŠ¨ç”»å˜ä½“ç»è¿‡ç»„ç»‡ä»¥æé«˜å¯ç»´æŠ¤æ€§ï¼š

```typescript
export const buttonVariants: Variants = {
  [FormStatus.Idle]: {
    scale: 1,
    transition: {
      type: 'spring',
      stiffness: 400,
      damping: 10,
    },
  },
  [FormStatus.Loading]: {
    opacity: 0.75,
  },
  [FormStatus.Success]: {
    opacity: 0.75,
  },
};
```

åŠ¨ç”»ä¸ºä»¥ä¸‹çŠ¶æ€æä¾›è§†è§‰åé¦ˆï¼š

- è¡¨å•çŠ¶æ€è½¬æ¢ï¼ˆç©ºé—² â†’ åŠ è½½ â†’ æˆåŠŸ/é”™è¯¯ï¼‰
- é”™è¯¯æ¶ˆæ¯å‡ºç°
- æŒ‰é’®çŠ¶æ€å˜åŒ–

### 7. Buttondown é›†æˆ

æˆ‘ä»¬ä½¿ç”¨ Buttondown ä½œä¸ºè®¢é˜…æœåŠ¡ï¼Œå®ƒæä¾›äº†æ¸…æ™°çš„ API å’Œæœ‰ç”¨çš„åŠŸèƒ½ï¼Œå¦‚æ ‡ç­¾å’Œå…ƒæ•°æ®ï¼š

```typescript
const response = await fetch('https://api.buttondown.email/v1/subscribers', {
  method: 'POST',
  headers: {
    Authorization: `Token ${BUTTONDOWN_API_KEY}`,
  },
  body: JSON.stringify({
    email_address: result.data.email,
    type: 'regular',
    metadata: {
      locale: result.data.locale,
    },
  }),
});
```

## ä»£ç ç»„ç»‡

ä»£ç åº“åˆ†ä¸ºå‡ ä¸ªå…³é”®æ–‡ä»¶ï¼š

1. `types.ts` - åŒ…å«å…±äº«ç±»å‹å’Œæšä¸¾
2. `newsletter-form.tsx` - ä¸»è¡¨å•ç»„ä»¶
3. `newsletter-form.variants.ts` - åŠ¨ç”»å˜ä½“
4. `validations/newsletter.ts` - éªŒè¯æ¨¡å¼å’Œé”™è¯¯å¤„ç†

è¿™ç§å…³æ³¨ç‚¹åˆ†ç¦»ä½¿ä»£ç æ›´æ˜“ç»´æŠ¤å’Œæµ‹è¯•ã€‚

## ç”¨æˆ·ä½“éªŒè€ƒè™‘

1. **è§†è§‰åé¦ˆ**ï¼šæäº¤æŒ‰é’®é€šè¿‡å¹³æ»‘çš„åŠ¨ç”»è½¬æ¢æ˜¾ç¤ºåŠ è½½å’ŒæˆåŠŸçŠ¶æ€
2. **é”™è¯¯å¤„ç†**ï¼šé”™è¯¯æ¶ˆæ¯ä»¥æŸ”å’Œçš„åŠ¨ç”»å‡ºç°ï¼Œè‡ªç„¶åœ°èå…¥é¡µé¢æµ
3. **å“åº”å¼è®¾è®¡**ï¼šè¡¨å•èƒ½å¤Ÿä¼˜é›…åœ°é€‚åº”ä¸åŒå±å¹•å°ºå¯¸
4. **æ·±è‰²æ¨¡å¼**ï¼šè¡¨å•éµå¾ªç”¨æˆ·çš„ä¸»é¢˜åå¥½

## æœªæ¥æ”¹è¿›

ä¸€äº›æ½œåœ¨çš„å¢å¼ºåŠŸèƒ½ï¼š

1. **åˆ†æ**ï¼šè·Ÿè¸ªè®¢é˜…æ¥æºå’Œè½¬åŒ–ç‡
2. **A/B æµ‹è¯•**ï¼šæµ‹è¯•ä¸åŒçš„è¡¨å•å¸ƒå±€å’Œæ–‡æ¡ˆ
3. **æ¬¢è¿é‚®ä»¶**ï¼šå®ç°ç”¨æˆ·é¦–é€‰è¯­è¨€çš„è‡ªåŠ¨æ¬¢è¿é‚®ä»¶
4. **ç¤¾äº¤è¯æ˜**ï¼šæ·»åŠ è®¢é˜…è€…æ•°é‡æˆ–æ¨èè¯­
5. **é¢„è§ˆ**ï¼šå±•ç¤ºç¤ºä¾‹è®¢é˜…å†…å®¹

## ç»“è®º

æ„å»ºè®¢é˜…ç³»ç»Ÿä¸ä»…ä»…æ˜¯æ”¶é›†ç”µå­é‚®ä»¶åœ°å€ã€‚é€šè¿‡å…³æ³¨ç±»å‹å®‰å…¨ã€ä»£ç ç»„ç»‡ã€ç”¨æˆ·ä½“éªŒå’Œå¼ºå¤§çš„é”™è¯¯å¤„ç†ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ—¢å®ç”¨åˆä»¤äººæ„‰æ‚¦çš„ç³»ç»Ÿã€‚

æŸ¥çœ‹ [NewsletterForm ç»„ä»¶](https://github.com/timleecoder42/betterhiretimlee.now/blob/main/src/components/newsletter/newsletter-form.tsx)å’Œ [API è·¯ç”±](https://github.com/timleecoder42/betterhiretimlee.now/blob/main/src/app/api/newsletter/route.ts)äº†è§£å®ç°ç»†èŠ‚ã€‚æ¬¢è¿å°†å…¶ä½œä¸ºä½ è‡ªå·±é¡¹ç›®çš„çµæ„Ÿï¼

æƒ³è¦äº²è‡ªä½“éªŒï¼Ÿåªéœ€æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨ï¼Œè¯•è¯•è®¢é˜…è¡¨å•å§ï¼ğŸš€
