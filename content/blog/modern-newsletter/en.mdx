---
title: 'Building a Modern Newsletter System with Next.js and Buttondown'
date: '2025-02-11'
excerpt: 'A deep dive into creating a polished newsletter subscription system with internationalization, animations, and robust error handling.'
---

Creating a newsletter subscription system might seem straightforward at first, but building one that's polished, user-friendly, and robust requires careful consideration of many aspects. In this post, I'll share how I built the newsletter system for this website using Next.js, Buttondown, and various modern web technologies.

## Features Overview

The newsletter system includes several key features:

- üåê Internationalization support for multiple languages
- ‚ú® Smooth animations and transitions
- üõ°Ô∏è Rate limiting and validation
- üé® Beautiful UI with gradient animations
- üîÑ Comprehensive error handling
- üì± Responsive design
- üåô Dark mode support

## Technical Implementation

### 1. Type-Safe Error Handling with Enums

We use TypeScript enums for type-safe error handling, ensuring consistent error codes across the application:

```typescript
export enum NewsletterErrorCode {
  InvalidEmail = 'INVALID_EMAIL',
  AlreadySubscribed = 'ALREADY_SUBSCRIBED',
  RateLimited = 'RATE_LIMITED',
  ServerError = 'SERVER_ERROR',
  UnknownError = 'UNKNOWN_ERROR',
}
```

This approach provides better type safety and autocompletion compared to string literals.

### 2. Form State Management

We manage form states using a dedicated enum, making the code more maintainable and type-safe:

```typescript
export enum FormStatus {
  Idle = 'idle',
  Loading = 'loading',
  Success = 'success',
  Error = 'error',
}
```

This enum is used throughout the component for consistent state management and animations.

### 3. Zod Schema with Enum Integration

Our Zod schema integrates with the error enum for type-safe validation:

```typescript
export const newsletterSchema = z.object({
  email: z.string().email({ message: NewsletterErrorCode.InvalidEmail }),
  locale: z.string().min(2).max(10),
});
```

### 4. API Route with Rate Limiting

The API route includes rate limiting to prevent abuse:

```typescript
const RATE_LIMIT = {
  WINDOW: 3600000, // 1 hour in milliseconds
  MAX_REQUESTS: 10,
} as const;
```

We track requests per IP address and enforce a limit of 10 attempts per hour.

### 5. Animated UI Components

The form features smooth animations using Framer Motion, with variants organized for better maintainability:

```typescript
export const buttonVariants: Variants = {
  [FormStatus.Idle]: {
    scale: 1,
    transition: {
      type: 'spring',
      stiffness: 400,
      damping: 10,
    },
  },
  [FormStatus.Loading]: {
    opacity: 0.75,
  },
  [FormStatus.Success]: {
    opacity: 0.75,
  },
};
```

The animations provide visual feedback for:

- Form state transitions (idle ‚Üí loading ‚Üí success/error)
- Error message appearances
- Button state changes

### 6. Buttondown Integration

We use Buttondown as our newsletter service, which offers a clean API and useful features like tags and metadata:

```typescript
const response = await fetch('https://api.buttondown.email/v1/subscribers', {
  method: 'POST',
  headers: {
    Authorization: `Token ${BUTTONDOWN_API_KEY}`,
  },
  body: JSON.stringify({
    email_address: result.data.email,
    type: 'regular',
    metadata: {
      locale: result.data.locale,
    },
  }),
});
```

## Code Organization

The codebase is organized into several key files:

1. `types.ts` - Contains shared types and enums
2. `newsletter-form.tsx` - Main form component
3. `newsletter-form.variants.ts` - Animation variants
4. `validations/newsletter.ts` - Validation schema and error handling

This separation of concerns makes the code more maintainable and easier to test.

## User Experience Considerations

1. **Visual Feedback**: The submit button transforms to show loading and success states, with smooth animations for state transitions.
2. **Error Handling**: Error messages appear with a gentle animation and are positioned naturally in the flow.
3. **Responsive Design**: The form adapts beautifully to different screen sizes.
4. **Dark Mode**: The form respects the user's theme preference.

## Future Improvements

Some potential enhancements we could add:

1. **Analytics**: Track subscription sources and conversion rates
2. **A/B Testing**: Test different form layouts and copy
3. **Welcome Emails**: Implement automated welcome emails in the subscriber's preferred language
4. **Social Proof**: Add a subscriber count or testimonials
5. **Preview**: Show example newsletter content

## Conclusion

Building a newsletter system goes beyond just collecting email addresses. By focusing on type safety, code organization, user experience, and robust error handling, we've created a system that's both functional and delightful to use.

Check out the [NewsletterForm component](https://github.com/timleecoder42/betterhiretimlee.now/blob/main/src/components/newsletter/newsletter-form.tsx) and [API route](https://github.com/timleecoder42/betterhiretimlee.now/blob/main/src/app/api/newsletter/route.ts) for the implementation details. Feel free to use it as inspiration for your own projects!

Want to see it in action? Just scroll down to the bottom of this page to try the newsletter subscription form yourself! üöÄ
